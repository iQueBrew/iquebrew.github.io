# 如何在神游机上安装Jbop的HackIt Patcher（占位，待完成）

### 需求

- 能够熟悉使用命令行工具；
- 有一台**运行32位Windows XP的电脑或者虚拟机**（以下简称副电脑）；
- iQue@Home神游机USB驱动；
- 会将神游机用USB线连接到电脑
- 能够熟练地在副电脑与**您常用的电脑**（以下简称主电脑）之间传输文件
- 能够熟练使用十六进制编辑器，比如**HxD**；
- 主电脑上需要安装[Python 3](https://www.python.org/ )。

### 流程

1. 使用Stuckpixel的**ique_cbc_attack**工具在神游机上执行初始化代码；
2. 用eSKape payload获取神游机的密钥以及相关信息，同时取得ticket.sys以待编辑；
3. 检查主机固件版本，安装对应版本的系统菜单补丁；
4. 编辑ticket.sys，在神游机上安装软件。

这个教程将会一步一步地进行。您应该保证在进行下一步前，已经正确完成了前一步的操作。
建议在操作前熟悉本教程。

### 第一步：执行初始化代码

在这一步中，我们将会使用Stuckpixel的**ique_cbc_attack**工具破解马力欧医生，并在其之上执行代码。
* 在开始前，请保证马力欧医生已经被传输到你的神游机上，且至少运行过一次。
* 在这一步中，马力欧医生的游戏存档将会被覆盖。如果游戏存档很重要，请根据[此教程](此教程尚不存在) （此教程尚不存在）来备份您的存档。
* 对于这一步骤中的某些部分，在64位的Windows 10上可能不同。根据主电脑使用的系统，您可能需要调整某些步骤。

1. 将你的神游机连接到副电脑上，打开神游机并在副电脑上运行**ique_diag**。输入`B`来初始化连接。
2. 输入`3 005d1870.rec`，以把马力欧医生游戏的加密ROM拷贝到副电脑上。
3. 把**005d1870.rec**复制到主电脑上，并将此文件与**ique_cbc_attack**放置在同一文件夹下。
4. 在主电脑上，打开命令行并将工作目录设为以上的文件夹，并执行以下命令：
```
ique_cbc_attack -p 3C088001350818E03C09000135298ED0 -r 005d1870.rec -d 081F0000000000000000000000000000 -o 1000
```

屏幕上应该显示：

```
AES-CBC attack, by stuckpixel
successfully injected 1 blocks!
```



5. 将**005d1870.rec**复制到副电脑上，并将此文件与**ique_diag**放置在同一文件夹下。
6. 在**ique_diag**中，输入`4 005d1870.rec`来把修改后的马力欧医生ROM写入神游机。
7. 在主电脑上，把**v2_dump.sta**重命名为**005d1870.sta**。
8. 把**005d1870.sta**复制到副电脑上，并将此文件与**ique_diag**放置在同一文件夹下。
9. 在**ique_diag**中，输入`4 005d1870.sta`来把神游机密钥拷贝器写入神游机。
10. 在**ique_diag**中，输入`Q`来断开与神游机的数据连接，但是不要关闭**ique_diag**。
11. 关闭神游机并且断开神游机与副电脑的线缆连接。

#### 第二步：复制神游机的密钥

1. 在不插入USB线的情况下打开神游机，神游机将进入神游菜单。
2. 从主菜单的游戏列表中打开马力欧医生。神游机应该会黑屏。
3. 几秒后，**单击一次**电源按钮来返回到神游菜单，当神游菜单打开后，**单击一次**电源按钮来关闭神游机。
4. 把神游机通过USB线连接到副电脑上，然后打开神游机。
5. 在**ique_diag**中，输入`B`来初始化连接，然后输入`3 005d1870.sta`来把包含神游机密钥的存档文件复制到你的副电脑上。
6. 将**005d1870.sta**从包含**ique_diag**的文件夹复制到你的主电脑上，然后使用十六进制编辑器打开它。
7. 将位于**0x600**到**0x700**的数据复制到一个新文件。设置一个类似于**V2.bin**这样的文件名，并把它保存在主电脑上一个你能记住的位置。
8. 在副电脑上**ique_diag**中，输入`3 ticket.sys`来把神游机的购买标识文件复制到副电脑上。
9. 将**ticket.sys**从副电脑上包含**ique_diag**的文件夹复制到你的主电脑上一个你能记住的位置。

#### 第三步：安装Jbop的HackIt Menu补丁

有很多种方式来得知你的神游机的固件版本。为了完成这篇教程，我们假设你还没有制作一个NAND备份。
有且只有两种SKSA版本支持USB。两种版本的系统主菜单左上角中都有神游在线LOGO。如果你的神游机主菜单上没有这个LOGO，说明你的神游机不支持神游在线。

1. 将**hackit_patcher.sta**重命名为**005d1870.sta**。
2. 将**005d1870.sta**复制到副电脑上，并将此文件与**ique_diag**放置在同一文件夹下。
3. 在**ique_diag**中，输入`4 005d1870.sta`来把系统菜单补丁写入神游机。

#### 第四步：编辑神游机的ticket.sys文件

1. 在主电脑中，使用Python打开**ticket.sys_editor.py**。
2. 点击*File*-*Open file*，然后选择刚才从主机中复制出的**ticket.sys**文件，然后点击*Open*。
3. 作为一个测试，选择左侧列表中的**塞尔达的传说**。点击*Ticket data*选项卡，然后点击*Ticket ID:*来打开购买标识ID编辑器。取消选中*Is trial ticket:*旁边的复选框，然后关闭购买标识ID编辑器窗口。
4. 点击*File*-*Save as*，然后选择一个主电脑上你能记住的位置，将文件名设置为**hackit.sys**，然后点击*Save*来保存已编辑过的文件。
5. 将**hackit.sys**从主电脑上复制到副电脑上，并将其放置在包含**ique_diag**的文件夹中。
6. 在In **ique_diag**中，输入`4 hackit.sys`来把修改过的文件写入神游机，然后输入`Q`来中断数据连接而不关闭**ique_diag**。
7. 关闭神游机并且断开神游机与副电脑的线缆连接。
8. 在不插入USB线的情况下打开神游机，神游机将进入神游菜单。
9. 从主菜单的游戏列表中打开马力欧医生。神游机应该会黑屏。
10. 几秒后，**单击一次**电源按钮来返回到神游菜单，当神游菜单打开后，进入游戏列表，并且一直向下滚动列表直到看见塞尔达传说：时光之笛。在这一项的右侧，游戏占用格数（114）与指示游戏目前在神游机上或者寄存到电脑上的标识之间，指示游戏是否为试玩版的方块应该为红色，即已购买该游戏。这表明补丁生效，以及系统菜单的签名已被成功破解。

此时，你的神游机已经成功破解了。你现在可以使用**ticket.sys_editor.py**和**iQueCrypt**来给神游机下载游戏。
